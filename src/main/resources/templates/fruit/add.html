<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ·»åŠ æ°´æœ - æ°´æœå•†åŸç®¡ç†ç³»ç»Ÿ</title>
  <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      min-height: 100vh;
      font-family: "Microsoft YaHei", sans-serif;
      background-color: #f8f9fa;
    }
    .navbar {
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      z-index: 1000;
    }
    .navbar-brand {
      font-size: 1.25rem;
      font-weight: 700;
      color: #fff !important;
    }
    .nav-link {
      color: #fff !important;
      transition: all 0.3s;
    }
    .nav-link:hover {
      color: #ffc107 !important;
    }
    .main-content {
      padding: 2rem 0;
    }
    .container {
      max-width: 800px;
    }
    .card {
      border: none;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: all 0.3s ease;
      overflow: hidden;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.12);
    }
    .card-header {
      background-color: #28a745;
      color: #fff;
      font-weight: 600;
      border-bottom: none;
    }
    .form-control {
      border-radius: 6px;
      padding: 0.75rem 1rem;
    }
    .form-label.required::after {
      content: '*';
      color: #dc3545;
      margin-left: 4px;
    }
    .btn {
      border-radius: 6px;
      font-weight: 500;
      transition: all 0.2s;
    }
    .btn:hover {
      transform: scale(1.02);
    }
    .footer {
      background-color: #212529;
      color: #fff;
      padding: 1.5rem 0;
      text-align: center;
      font-size: 0.9rem;
    }
    @media (max-width: 768px) {
      .main-content {
        padding: 1rem 0;
      }
      .card-body {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
<!-- å¯¼èˆªæ  -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container">
    <a class="navbar-brand" th:href="@{/index.html}">ğŸ æ°´æœå•†åŸç®¡ç†ç³»ç»Ÿ</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto">
        <li class="nav-item">
          <a class="nav-link" th:href="@{/index.html}">é¦–é¡µ</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" th:href="@{/customer/list}">é¡¾å®¢ç®¡ç†</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" th:href="@{/fruit/list}">æ°´æœç®¡ç†</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" th:href="@{/order/list}">è®¢å•ç®¡ç†</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" th:href="@{/supplier/list}">ä¾›åº”å•†ç®¡ç†</a>
        </li>
      </ul>
      <ul class="navbar-nav">
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
            <span th:text="${session.loginUser?.showName ?: 'æ¸¸å®¢'}">é¡¾å®¢10099</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" th:href="@{/api/auth/logout}">é€€å‡ºç™»å½•</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- ä¸»è¦å†…å®¹åŒº -->
<div class="main-content container">
  <div class="card">
    <div class="card-header">
      <h5 class="mb-0">æ·»åŠ æ–°æ°´æœ</h5>
    </div>
    <div class="card-body">
      <form id="fruitForm">
        <div class="row g-3">
          <!-- æ–°å¢ï¼šæ°´æœIDè¾“å…¥æ¡†ï¼ˆæ•°æ®åº“f_idå¿…å¡«ï¼Œæ— é»˜è®¤å€¼ï¼‰ -->
          <div class="col-md-6">
            <label for="fid" class="form-label required">æ°´æœID *</label>
            <input type="text" class="form-control" id="fid" name="fid" placeholder="ä¾‹å¦‚ï¼šd1ã€z3" required>
            <div class="form-text">æ°´æœå”¯ä¸€æ ‡è¯†ï¼Œä¸å¯é‡å¤ï¼ˆå¦‚a1ã€b2ã€c0ï¼‰</div>
          </div>
          <!-- ä¿®æ”¹ï¼šå­—æ®µåä¿æŒå’Œåç«¯ä¸€è‡´ï¼Œæ ‡æ³¨å¿…å¡« -->
          <div class="col-md-6">
            <label for="fname" class="form-label required">æ°´æœåç§° *</label>
            <input type="text" class="form-control" id="fname" name="fname" placeholder="ä¾‹å¦‚ï¼šappleã€é¦™è•‰" required>
          </div>
          <div class="col-md-6">
            <label for="fprice" class="form-label required">ä»·æ ¼ *</label>
            <input type="number" class="form-control" id="fprice" name="fprice" step="0.01" min="0" placeholder="ä¾‹å¦‚ï¼š5.2ã€10.5" required>
          </div>
          <div class="col-md-6">
            <label for="quantity" class="form-label required">åº“å­˜ *</label>
            <input type="number" class="form-control" id="quantity" name="quantity" min="0" value="1000" required>
          </div>
          <div class="col-md-6">
            <label for="sid" class="form-label required">ä¾›åº”å•†ID *</label>
            <input type="number" class="form-control" id="sid" name="sid" min="1" placeholder="ä¾‹å¦‚ï¼š101ã€102" required>
            <div class="form-text">è¯·è¾“å…¥å·²å­˜åœ¨çš„ä¾›åº”å•†IDï¼ˆ100-107ï¼‰</div>
          </div>
          <!-- éå¿…å¡«å­—æ®µï¼šåç«¯è‹¥æœªæ¥æ”¶å¯ä¿ç•™ï¼Œä¸å½±å“æ ¸å¿ƒæäº¤ -->
          <div class="col-md-6">
            <label for="description" class="form-label">æè¿°</label>
            <textarea class="form-control" id="description" name="description" rows="1" placeholder="å¯é€‰ï¼šæ°´æœæè¿°ä¿¡æ¯"></textarea>
          </div>
          <div class="col-md-12">
            <label for="remark" class="form-label">å¤‡æ³¨</label>
            <input type="text" class="form-control" id="remark" name="remark" placeholder="å¯é€‰ï¼šå…¶ä»–å¤‡æ³¨ä¿¡æ¯">
          </div>
        </div>

        <div class="mt-4">
          <button type="submit" class="btn btn-success me-2">ä¿å­˜æ°´æœ</button>
          <button type="button" class="btn btn-secondary" onclick="goBack()">è¿”å›åˆ—è¡¨</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- é¡µè„š -->
<div class="footer">
  <p class="mb-0">Â© 2026 æ°´æœå•†åŸç®¡ç†ç³»ç»Ÿ - ç‰ˆæƒæ‰€æœ‰</p>
</div>

<!-- å¼•å…¥JSèµ„æº -->
<script th:src="@{/js/jquery-3.6.4.min.js}"></script>
<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/js/axios.min.js}"></script>

<!-- è‡ªå®šä¹‰JSé€»è¾‘ï¼ˆæ ¸å¿ƒä¿®æ”¹ï¼šå­—æ®µåå®Œå…¨åŒ¹é…åç«¯å°å†™ï¼‰ -->
<script>
  // å®šä¹‰ä¸Šä¸‹æ–‡è·¯å¾„ï¼ˆå’Œåˆ—è¡¨é¡µä¿æŒä¸€è‡´ï¼‰
  const contextPath = '/fruitshop';

  // è¡¨å•æäº¤äº‹ä»¶
  $('#fruitForm').on('submit', function(e) {
    e.preventDefault();
    saveFruit();
  });

  // ä¿å­˜æ°´æœï¼ˆæ ¸å¿ƒä¿®æ”¹ï¼šä¼ å‚å­—æ®µååŒ¹é…åç«¯å°å†™ï¼‰
  function saveFruit() {
    // 1. è·å–è¡¨å•å€¼ï¼Œå­—æ®µåå®Œå…¨åŒ¹é…åç«¯ï¼ˆfid/fname/fprice/sid/quantityï¼‰
    const fruitData = {
      fid: $('#fid').val().trim(),          // å¯¹åº”æ•°æ®åº“f_idï¼ˆå¿…å¡«ï¼‰
      fname: $('#fname').val().trim(),      // å¯¹åº”æ•°æ®åº“f_nameï¼ˆå¿…å¡«ï¼‰
      fprice: parseFloat($('#fprice').val()), // å¯¹åº”æ•°æ®åº“f_priceï¼ˆå¿…å¡«ï¼‰
      sid: parseInt($('#sid').val()),       // å¯¹åº”æ•°æ®åº“s_idï¼ˆå¿…å¡«ï¼‰
      quantity: parseInt($('#quantity').val()), // å¯¹åº”æ•°æ®åº“quantityï¼ˆå¿…å¡«ï¼‰
      description: $('#description').val().trim(), // éå¿…å¡«
      remark: $('#remark').val().trim()            // éå¿…å¡«
    };

    // 2. å‰ç«¯ä¸¥æ ¼éªŒè¯ï¼ˆç¡®ä¿å¿…å¡«å­—æ®µæœ‰å€¼ä¸”æ ¼å¼æ­£ç¡®ï¼‰
    if (!fruitData.fid) {
      alert('è¯·è¾“å…¥æ°´æœIDï¼ˆå¦‚a1ã€b2ï¼‰');
      $('#fid').focus();
      return;
    }
    if (!fruitData.fname) {
      alert('è¯·è¾“å…¥æ°´æœåç§°');
      $('#fname').focus();
      return;
    }
    if (isNaN(fruitData.fprice) || fruitData.fprice < 0) {
      alert('è¯·è¾“å…¥æœ‰æ•ˆçš„éè´Ÿä»·æ ¼ï¼ˆå¦‚5.2ã€10.0ï¼‰');
      $('#fprice').focus();
      return;
    }
    if (isNaN(fruitData.quantity) || fruitData.quantity < 0) {
      alert('è¯·è¾“å…¥æœ‰æ•ˆçš„éè´Ÿåº“å­˜æ•°é‡');
      $('#quantity').focus();
      return;
    }
    if (isNaN(fruitData.sid) || fruitData.sid <= 0) {
      alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ä¾›åº”å•†IDï¼ˆ100-107ï¼‰');
      $('#sid').focus();
      return;
    }

    // 3. å‘é€è¯·æ±‚ï¼ˆURLå’Œåˆ—è¡¨é¡µä¿æŒä¸€è‡´ï¼Œå‚æ•°ååŒ¹é…åç«¯ï¼‰
    axios.post(`${contextPath}/api/fruit/add`, fruitData)
            .then(res => {
              if (res.data && res.data.code === 200) {
                alert('æ°´æœæ·»åŠ æˆåŠŸï¼');
                // é‡ç½®è¡¨å•ï¼Œæ–¹ä¾¿ç»§ç»­æ·»åŠ 
                $('#fruitForm')[0].reset();
                // å¯é€‰ï¼šæ·»åŠ æˆåŠŸåè·³å›åˆ—è¡¨é¡µ
                // window.location.href = `${contextPath}/fruit/list`;
              } else {
                alert('æ·»åŠ å¤±è´¥: ' + (res.data?.message || 'æœªçŸ¥é”™è¯¯'));
              }
            })
            .catch(err => {
              console.error('æ·»åŠ æ°´æœå¤±è´¥:', err);
              console.error('åç«¯å“åº”:', err.response); // è°ƒè¯•ç”¨ï¼šæ‰“å°åç«¯å…·ä½“é”™è¯¯
              alert(`æ·»åŠ å¤±è´¥ï¼š${err.message || 'è¯·æ£€æŸ¥å­—æ®µæ˜¯å¦å¡«å†™æ­£ç¡®ï¼Œæˆ–æ°´æœIDå·²å­˜åœ¨'}`);
            });
  }

  // è¿”å›åˆ—è¡¨
  function goBack() {
    window.location.href = `${contextPath}/fruit/list`;
  }
</script>
</body>
</html>