spring:
  application:
    name: fruitshop-manager

  # 数据库配置
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    url: jdbc:mysql://localhost:3306/fruitshop?useUnicode=true&characterEncoding=UTF-8&serverTimezone=UTC&allowMultiQueries=true
    username: root
    password: 123456
    driver-class-name: com.mysql.cj.jdbc.Driver
    druid:
      initial-size: 5
      min-idle: 5
      max-active: 20
      max-wait: 60000
      time-between-eviction-runs-millis: 60000
      min-evictable-idle-time-millis: 300000
      validation-query: SELECT 1 FROM DUAL
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      pool-prepared-statements: true
      max-open-prepared-statements: 20
      use-global-data-source-stat: true
      name: DruidDataSource
      filters: stat,wall,log4j

  # JPA配置
  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false

  # MVC配置 - 修复静态资源路径（核心！）
  mvc:
    # 移除错误的static-path-pattern，使用默认配置（/xxx 映射到static/xxx）
    # static-path-pattern: /static/**  # 注释掉这行！
    throw-exception-if-no-handler-found: true

  # 静态资源配置
  web:
    resources:
      static-locations: classpath:/static/
      add-mappings: true

  # Thymeleaf配置
  thymeleaf:
    prefix: classpath:/templates/
    suffix: .html
    encoding: UTF-8
    mode: HTML
    cache: false
    check-template-location: false
    enabled: true

# MyBatis-Plus配置 - 修复mapper路径空格问题
mybatis-plus:
  mapper-locations: classpath:/mapper/*.xml  # 移除.xml前的空格
  type-aliases-package: com.fruitshop.entity
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    call-setters-on-nulls: true
  global-config:
    db-config:
      id-type: AUTO
      table-underline: true

# 日志配置 - 修复空格问题
logging:
  level:
    root: INFO
    com.fruitshop: DEBUG
    org.springframework.web: INFO  # 移除web前的空格
    org.springframework.security: DEBUG
    org.springframework.thymeleaf: DEBUG
    com.baomidou.mybatisplus: DEBUG  # 移除mybatisplus前的空格
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/fruitshop.log  # 移除.log前的空格

# 服务器配置
server:
  port: 8080
  servlet:
    context-path: /fruitshop  # 上下文路径，所有请求需加/fruitshop前缀
    session:
      timeout: 30m
      cookie:
        http-only: true
        secure: false
  tomcat:
    max-threads: 200
    min-spare-threads: 10
    max-connections: 20000
    accept-count: 100

# 管理端点
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always